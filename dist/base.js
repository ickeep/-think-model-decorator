'use strict';var _typeof2=require('babel-runtime/helpers/typeof'),_typeof3=_interopRequireDefault(_typeof2),_keys=require('babel-runtime/core-js/object/keys'),_keys2=_interopRequireDefault(_keys),_regenerator=require('babel-runtime/regenerator'),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=require('babel-runtime/helpers/asyncToGenerator'),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2);exports.__esModule=!0;exports.default=function(a){a.prototype.buildSql=(0,_asyncToGenerator3.default)(/*#__PURE__*/_regenerator2.default.mark(function a(){var b,c;return _regenerator2.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=new _parser2.default(think.config('model')),a.next=3,this.parseOptions(this.options);case 3:return c=a.sent,a.abrupt('return',b.buildSelectSql(c).trim());case 5:case'end':return a.stop();}},a,this)})),a.prototype.getSomeFields=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=a.obj,c=void 0===b?{}:b,d=a.fields,e=void 0===d?[]:d,f=a.removeEmpty,g=void 0!==f&&f,h={};return(0,_keys2.default)(c).forEach(function(a){0<=e.indexOf(a)&&'undefined'!=typeof c[a]&&(!g&&(h[a]=c[a]),g&&(''!==c[a]||null===c[a])&&(h[a]=c[a]))}),h},a.prototype.getFieldText=function(){for(var a,b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:'',c=this.getFields(),d=(0,_keys2.default)(c),e=think.isArray(b)?b:b.split(','),f=[],g=0;g<e.length;g+=1)a=e[g],0<=d.indexOf(a)&&f.push(a);return f.join(',')},a.prototype.getOrder=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=this.getFields();if('object'!==('undefined'==typeof a?'undefined':(0,_typeof3.default)(a))||'object'!==('undefined'==typeof b?'undefined':(0,_typeof3.default)(b)))return{};for(var c={},d=(0,_keys2.default)(a),e=0;e<d.length;e+=1){var f=d[e],g=f.replace(/Order$/,''),h=a[f];f!==g&&b[g]&&h&&(h=h.toLocaleUpperCase?h.toLocaleUpperCase():h,0<=['DESC','ASC'].indexOf(h)&&(c[g]=h))}return b.sticky&&think.isEmpty(c)&&(c.sticky='DESC'),b.time&&!c.time&&(c.time='DESC'),c},a.prototype.getWhere=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=this.getFields();if('object'!==('undefined'==typeof a?'undefined':(0,_typeof3.default)(a))||'object'!==('undefined'==typeof b?'undefined':(0,_typeof3.default)(b)))return{};for(var c={},d=(0,_keys2.default)(b),e=0;e<d.length;e+=1){var f=d[e],g=b[f];if('undefined'!=typeof a[f]&&''!==a[f])c[f]=a[f];else{var h=a[f+'s'];g.in&&h&&(c[f]=['IN',h.split(',')]);var j=f+'Max',k=f+'Min';g.num&&(0<a[j]||0<=a[k])&&(c[f]={},k&&a[k]&&(c[f]['>=']=a[k]),j&&a[j]&&(c[f]['<=']=a[j]));var l=a[f+'Like'];g.like&&l&&(c[f]=['like','%'+l+'%']);var m=a[f+'NotLike'];g.notLike&&m&&(c[f]=['NOTLIKE','%'+m+'%']);var n=a[f+'Not'];g.not&&n&&(c[f]=['!=',n])}}return c},a.prototype.rowsToTree=function(){function a(b,c){var e=b[f],g=b,h=o[e];if(h&&('all'===c||0<c)){g.child=[];for(var i=0;i<h.length;i+=1)g.child.push(a(d[h[i]],'all'===c?c:c-1))}return g}for(var b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},c=b.rows,d=c===void 0?[]:c,e=b.idKey,f=e===void 0?'id':e,g=b.parentKey,h=g===void 0?'parent':g,j=b.level,k=j===void 0?'all':j,l=b.parentId,m=l===void 0?0:l,n=[],o={},p=0;p<d.length;p+=1){var q=d[p],r=q[h]||0;o[r]||(o[r]=[]),o[r].push(p)}if(o[m])for(var s=0;s<o[m].length;s+=1){var t=o[m][s],u=a(d[t],k);n.push(u)}return n}};var _parser=require('think-model-abstract/lib/parser'),_parser2=_interopRequireDefault(_parser);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}